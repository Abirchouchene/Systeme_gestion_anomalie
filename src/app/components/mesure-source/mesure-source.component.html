<div class="mesure-container">
  <!-- En-tête -->
  <div class="header-section">
    <div class="header-content">
      <div class="title-group">
        <div class="icon-wrapper">
          <i class="fas fa-chart-line"></i>
        </div>
        <div>
          <h2 class="page-title">Mesures par Source</h2>
          <p class="page-subtitle">Consultez et gérez vos mesures d'analyse</p>
        </div>
      </div>
      <button class="btn-add" (click)="ouvrirModal()">
        <i class="fas fa-plus"></i>
        <span>Nouvelle mesure</span>
      </button>
    </div>
  </div>

  <!-- Barre de recherche -->
  <div class="search-section">
    <div class="search-card">
      <div class="search-icon">
        <i class="fas fa-search"></i>
      </div>
      <input
        [(ngModel)]="sourceId"
        type="text"
        class="search-input"
        placeholder="Rechercher par identifiant de source..."
        (keyup.enter)="charger()">
      <button class="btn-search" (click)="charger()" [disabled]="!sourceId.trim()">
        Rechercher
      </button>
    </div>
  </div>

  <!-- Zone de contenu -->
  <div class="content-section">
    <!-- Chargement -->
    <div *ngIf="loading" class="loading-state">
      <div class="spinner"></div>
      <p>Chargement des mesures en cours...</p>
    </div>

    <!-- Aucun résultat -->
    <div *ngIf="!loading && recherchEffectuee && mesures.length === 0" class="empty-state">
      <div class="empty-icon">
        <i class="fas fa-inbox"></i>
      </div>
      <h3>Aucune mesure trouvée</h3>
      <p>Aucune mesure n'a été trouvée pour cette source</p>
      <button class="btn-add-empty" (click)="ouvrirModal()">
        <i class="fas fa-plus"></i>
        Ajouter la première mesure
      </button>
    </div>

    <!-- Grille de mesures -->
    <div *ngIf="!loading && mesures.length > 0" class="mesures-grid">
      <div class="mesure-card" *ngFor="let m of mesures; let i = index"
           [style.animation-delay]="(i * 0.05) + 's'">
        <div class="mesure-header">
          <div class="mesure-icon" [class]="'bg-' + getCouleurIndicateur(m.indicateur)">
            <i class="fas" [class]="getIconeIndicateur(m.indicateur)"></i>
          </div>
          <span class="mesure-badge">{{ m.indicateur }}</span>
        </div>

        <div class="mesure-body">
          <div class="mesure-value">
            {{ m.valeur }}
          </div>

          <div class="mesure-meta" *ngIf="m.date">
            <i class="far fa-calendar"></i>
            {{ m.date | date: 'dd/MM/yyyy HH:mm' }}
          </div>
        </div>

        <div class="mesure-footer">
          <span class="source-id">
            <i class="fas fa-database"></i>
            Source: {{ m.sourceId }}
          </span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal d'ajout -->
<div class="modal fade" id="addMesureModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content modern-modal">
      <div class="modal-header">
        <div class="modal-title-group">
          <div class="modal-icon">
            <i class="fas fa-plus-circle"></i>
          </div>
          <div>
            <h5 class="modal-title">Ajouter une nouvelle mesure</h5>
            <p class="modal-subtitle">Remplissez les informations ci-dessous</p>
          </div>
        </div>
        <button type="button" class="btn-close-modal" data-bs-dismiss="modal">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <form [formGroup]="mesureForm" (ngSubmit)="ajouterMesure()">
        <div class="modal-body">
          <div class="form-grid">
            <!-- Source ID -->
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-database"></i>
                Identifiant Source
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="sourceId"
                placeholder="Ex: SRC-001"
                [class.is-invalid]="mesureForm.get('sourceId')?.invalid && mesureForm.get('sourceId')?.touched">
              <div class="invalid-feedback" *ngIf="mesureForm.get('sourceId')?.invalid && mesureForm.get('sourceId')?.touched">
                Ce champ est requis
              </div>
            </div>

            <!-- Indicateur -->
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-tag"></i>
                Indicateur
              </label>
              <input
                type="text"
                class="form-control"
                formControlName="indicateur"
                placeholder="Ex: Température"
                [class.is-invalid]="mesureForm.get('indicateur')?.invalid && mesureForm.get('indicateur')?.touched">
              <div class="invalid-feedback" *ngIf="mesureForm.get('indicateur')?.invalid && mesureForm.get('indicateur')?.touched">
                Ce champ est requis
              </div>
            </div>

            <!-- Valeur -->
            <div class="form-group">
              <label class="form-label">
                <i class="fas fa-calculator"></i>
                Valeur
              </label>
              <input
                type="number"
                step="0.01"
                class="form-control"
                formControlName="valeur"
                placeholder="Ex: 25.5"
                [class.is-invalid]="mesureForm.get('valeur')?.invalid && mesureForm.get('valeur')?.touched">
              <div class="invalid-feedback" *ngIf="mesureForm.get('valeur')?.invalid && mesureForm.get('valeur')?.touched">
                Veuillez entrer une valeur valide
              </div>
            </div>

            <!-- Date -->
            <div class="form-group full-width">
              <label class="form-label">
                <i class="far fa-calendar-alt"></i>
                Date et heure
              </label>
              <input
                type="datetime-local"
                class="form-control"
                formControlName="date"
                [class.is-invalid]="mesureForm.get('date')?.invalid && mesureForm.get('date')?.touched">
              <div class="invalid-feedback" *ngIf="mesureForm.get('date')?.invalid && mesureForm.get('date')?.touched">
                Ce champ est requis
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-cancel" data-bs-dismiss="modal" [disabled]="submitting">
            <i class="fas fa-times"></i>
            Annuler
          </button>
          <button type="submit" class="btn-submit" [disabled]="submitting">
            <span *ngIf="!submitting">
              <i class="fas fa-check"></i>
              Enregistrer
            </span>
            <span *ngIf="submitting">
              <i class="fas fa-spinner fa-spin"></i>
              Enregistrement...
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
